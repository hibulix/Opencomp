var firstVisibleField=$("form").find("input[type=text],textarea,select").filter(":visible:first");firstVisibleField.focus().select();var successSound=new Audio("/img/success.mp3");var errorSound=new Audio("/img/error.mp3");var completedSound=new Audio("/img/completed.mp3");var pupilIdField=$("#pupil-id");var resultsFields=$(".result");var cancelButton=$("#cancel");var resultsBlock=$("#results-input");var pupilBlock=$("#pupil-input");var baseURL=$("#base_url").text();var evaluation;var pupil_id;pupilIdField.on("keydown",function(c){var a=c.which||c.keyCode;var b=$(".showSweetAlert").filter(":visible").length;if(a==13&&b){c.preventDefault();sweetAlert.close()}if(a==9||a==13){c.preventDefault();checkPupil(pupilIdField)}});pupilIdField.on("blur",function(){checkPupil(pupilIdField)});resultsFields.on("keydown",function(b){var a=b.which||b.keyCode;if(a==13){b.preventDefault();$.emulateTab()}});resultsFields.blur(function(a){checkResult(a)});cancelButton.on("click",function(){resetLayout()});function loadResults(d){for(var c in d){if(d.hasOwnProperty(c)){var a=d[c].result;var e=d[c].competence_id+"_"+d[c].pupil_id;var b=$("#"+e);b.text(a);setResultColor(b)}}$("#loading").hide();$("#loaded").show();setTimeout(function(){$("#loaded").fadeOut()},5000)}function setResultColor(d){var b={a:"success",b:"info",c:"warning",d:"danger",ne:"dark",abs:"dark"};var a=d.text().toLowerCase();var c="label-"+b[a];d.removeClass().addClass("badge").addClass(c)}function animateResult(a,b){setResultColor(a);a.addClass("animated "+b);setTimeout(function(){a.removeClass("animated "+b)},1000)}function checkPupil(c){pupil_id=parseInt(c.val());if(!isNaN(pupil_id)){var d=$("#"+pupil_id);var b=d.length!==0;if(b){$("#pupil-name").text(d.text());$("#"+pupil_id).parent().addClass("info");pupilBlock.hide();loadPupilResults();resultsBlock.show();var a=resultsBlock.find("input[type=text],textarea,select").filter(":visible:first");a.click().focus().select()}else{c.val("").focus();errorSound.play();sweetAlert("Code élève inconnu","Le code élève que vous avez scanné est incorrect ou l'élève n'a pas passé cette évaluation !","error")}}else{c.val("").focus()}}function resetLayout(){resultsFields.val("").removeClass("success");resultsBlock.hide();pupilIdField.val("");pupilBlock.show({duration:1,complete:function(){pupilIdField.focus().select()}})}function loadPupilResults(){$(".result").each(function(){var a=$(this).attr("id");$(this).val($("#"+a+"_"+pupil_id).text())})}function setPupilResults(){$("th").removeClass("success").removeClass("info");$("#"+pupil_id).parent().addClass("success");$(".result").each(function(){var a=$(this).attr("id");var b=$("#"+a+"_"+pupil_id);b.text($(this).val());animateResult(b,"tada")})}function getResults(){var b={};b["Pupils[id]"]=pupil_id;var a=0;$(".result").each(function(){var c=$(this).attr("id");var d=$(this).val();if(d!==""){b["Results["+a+"][competence_id]"]=c;b["Results["+a+"][result]"]=d}a++});return b}function checkResult(e){var d=$(e.delegateTarget);var f=d.val();var c=$("form").find("input[type=text]").filter(":visible:last");var b=d.attr("id")===c.attr("id");d.removeClass("error").removeClass("success");if($.inArray(f,["AAA","QQQ","A","a"])!==-1){d.val("A").addClass("success")}else{if($.inArray(f,["BBB","B","b"])!==-1){d.val("B").addClass("success")}else{if($.inArray(f,["CCC","C","c"])!==-1){d.val("C").addClass("success")}else{if($.inArray(f,["DDD","D","d"])!==-1){d.val("D").addClass("success")}else{if($.inArray(f,["NEE","NE","ne"])!==-1){d.val("NE").addClass("success");d.css("background-color","#e4ffcb")}else{if($.inArray(f,["ABS","QBS","abs"])!==-1){d.val("ABS").addClass("success")}else{if($.inArray(f,["","DEL"])!==-1){d.val("").addClass("success")}else{d.addClass("error");if(b){setTimeout(function(){d.focus().select()},1)}else{d.select()}errorSound.play()}}}}}}}if(b&&!d.hasClass("error")){saveResults();setPupilResults();resetLayout();var a=$(".badge:empty").length;if(a===0){completedSound.play();swal({title:"Beau travail !",text:"Vous avez saisi tous les résultats de cette évaluation.",type:"success",timer:5000,showConfirmButton:true})}else{successSound.play()}}}function saveResults(){var a=getResults();var b=baseURL+"results/add/"+evaluation.id+".json";$.post(b,a,function(c){})};