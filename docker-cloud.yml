# Host node is tested with Debian Jessie 8
#
# To BYON (Bring Your Own Node) you need to install
# git and Docker Cloud Agent
#
# Sources must be git cloned from 
# git@github.com:Opencomp/Opencomp.git to /root/Opencomp
#
# Edit src/Config/app.php accordingly

db:
  image: 'mysql:5.7'
  environment:
    - MYSQL_ROOT_PASSWORD=root
  ports:
    - '3306:3306'
  volumes:
    - '/root/data:/var/lib/mysql'
java-servlets:
  image: 'tomcat:7-jre8'
  ports:
    - '8080:8080'
  volumes:
    - '/root/Opencomp/java_servlets:/usr/local/tomcat/webapps'
load-balancer:
  image: 'jwilder/nginx-proxy:latest'
  ports:
    - '80:80'
  volumes:
    - '/var/run/docker.sock:/tmp/docker.sock:ro'
memcached:
  image: 'memcached:alpine'
message-queue:
  image: 'schickling/beanstalkd:latest'
  expose:
    - '11300'
pdf-worker:
  image: 'opencomp/pdf_worker:latest'
  links:
    - db
    - message-queue
  restart: always
  target_num_containers: 5
  volumes:
    - '/root/Opencomp:/var/www/html'
web:
  image: 'opencomp/web:latest'
  environment:
    - VIRTUAL_HOST=84858fd8-22f3-4f9c-b421-b621e1ad856b.pub.cloud.scaleway.com
  expose:
    - '80'
  links:
    - db
    - memcached
    - message-queue
  target_num_containers: 4
  volumes:
    - '/root/Opencomp:/var/www/html'

